<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<title>Выписка</title>
<style>
@font-face {
  font-family: "DejaVuSans";
  src: url("static/DejaVuSans.ttf") format("truetype");
}
@font-face {
  font-family: "DejaVuSans";
  src: url("static/DejaVuSans-Bold.ttf") format("truetype");
  font-weight: bold;
}
@page {
  size: A4 portrait;
  margin: 0;
}
body{
  background-color: slategray;
  margin:0;
}
div.page{
  position:relative;
  background-color:white;
  margin:1em auto;
  box-shadow:1px 1px 8px -2px black;
  width:595pt;
  height:842pt;
  font-family:"DejaVuSans",sans-serif;
  font-size:8pt;
  line-height:1.2;
}
p{position:absolute;white-space:pre;margin:0;}
h1{position:absolute;top:22pt;left:20pt;font-size:16pt;font-weight:normal;margin:0;}
img.logo{position:absolute;top:20pt;right:20pt;height:32pt;}
div.account-summary{
  position:absolute;
  top:80pt;
  left:20pt;
  width:555pt;
  height:24.5pt;
  border-top:0.5pt solid #000;
  border-bottom:0.5pt solid #000;
}
div.account-summary p{
  position:absolute;
  top:8.4pt;
  line-height:8pt;
  font-weight:bold;
}
div.account-summary p.account{left:2pt;}
div.account-summary p.opening-label{left:298pt;}
div.account-summary p.opening-amount{left:516.3pt;}
.period {
  position: absolute;
  top: 61.3pt;
  left: 20pt;
  margin: 0;
  font-size: 10pt;      /* увеличенный весь блок */
  line-height: 1.1;
  white-space: nowrap;  /* чтобы не переносилось */
}
table.operations{
  position:absolute;
  top:104.5pt;
  left:20pt;
  width:555pt;
  border-collapse:collapse;
  table-layout:fixed;
}
table.operations col:nth-child(1){width:68pt;}
table.operations col:nth-child(2){width:173pt;}
table.operations col:nth-child(3){width:246pt;}
table.operations col:nth-child(4){width:68pt;}
/* Заголовок: жирная нижняя граница */
table.operations thead th {
  padding: 4px 6px;
  font-weight: bold;
  border-bottom: 1pt solid #000;
  text-align: left;
}

/* Строки: разделитель между ними */
table.operations tbody tr td {
  padding: 4px 6px;
  vertical-align: top;
  word-break: break-word;
  overflow-wrap: anywhere;
}

/* линия между обычными операциями */
table.operations tbody tr:not(.closing-row):not(.totals-row):not(.last-op-row) td {
  border-bottom: 0.3pt solid #444444;
}

/* Итоги: жирные границы сверху/снизу */
table.operations tr.closing-row td {
  font-weight: bold;
  border-top: 1pt solid #000;
  border-bottom: 0.5pt solid #000;
}

/* Поступление / Списание: выделяются, последняя строка подведена */
table.operations tr.totals-row td {
  font-weight: bold;
  border-top: 0.5pt solid #000;
  border-bottom: 0.5pt solid #000;
}

/* Последняя операция без нижней границы */
table.operations tr.last-op-row td {
  border-bottom: 0;
}

/* Выравнивание последнего столбца */
table.operations td:last-child {
  text-align: right;
  vertical-align: bottom;
}
table.operations td.closing-label{padding-left:57pt;}
table.operations td.total-in{padding-left:151pt;font-weight:bold;}
table.operations td.total-out{padding-left:167pt;font-weight:bold;}
.footer-left{position:absolute;top:781.1pt;left:20pt;font-size:9pt;}
.footer-left2{position:absolute;top:791.6pt;left:20pt;font-size:9pt;}
.footer-right-name{position:absolute;top:781.3pt;left:373.7pt;font-size:10pt;}
.footer-right-time{position:absolute;top:792.9pt;left:458.3pt;font-size:10pt;}
</style>
</head>

<body>
<div class="page">
  <img src="static/logo.png" alt="Логотип" class="logo"/>

  <h1>Выписка</h1>
  <p class="period">Период: {{ data.statement.period_start|date }} – {{ data.statement.period_end|date }}</p>
  <div class="account-summary">
    <p class="account">Счёт: {{ data.account.number|account_format }}</p>
    <p class="opening-label">Входящий остаток на {{ data.statement.period_start|date }}</p>
    <p class="opening-amount">{{ opening_balance|rub_format }}</p>
  </div>

  <table class="operations">
    <colgroup><col/><col/><col/><col/></colgroup>
    <thead>
      <tr>
        <th>Дата</th>
        <th>Плательщик / Получатель</th>
        <th>Операция</th>
        <th>Сумма (RUB)</th>
      </tr>
    </thead>
    <tbody>
      {% for t in data.transactions %}
      <tr{% if loop.last %} class="last-op-row"{% endif %}>
        <td>{{ t.date|date }}</td>
        <td>{{ t.counterparty or '' }}</td>
        <td>{{ t.description }}</td>
        <td>{{ t.amount|rub_format }}</td>
      </tr>
      {% endfor %}
      <tr class="closing-row">
        <td></td>
        <td></td>
        <td class="closing-label">Исходящий остаток на {{ data.statement.period_end|date }}</td>
        <td>{{ closing_balance|rub_format }}</td>
      </tr>
      <tr class="totals-row">
        <td></td>
        <td></td>
        <td class="total-in">Поступление</td>
        <td>{{ total_incoming|rub_format }}</td>
      </tr>
      <tr class="totals-row">
        <td></td>
        <td></td>
        <td class="total-out">Списание</td>
        <td>{{ total_outgoing|rub_format }}</td>
      </tr>
    </tbody>
  </table>

  <p class="footer-left">ПАО «БАНК САНКТ-ПЕТЕРБУРГ»</p>
  <p class="footer-left2">БИК 044030790</p>
  <p class="footer-right-name">{{ data.account.user.username }}</p>
  <p class="footer-right-time">{{ data.statement.created_at|format_ts }}</p>
</div>
</body>
</html>

